## Meta Node

Используется пользователем для работы с системой, а также для поддержания высокой доступности системы.

Получая от пользователя команду с описанием графа обработки потока данных, Meta Node производит его валидацию и строит план запуска действий на серверах кластера. Этот план сохраняется в хранилище пользовательских данных.

При поступлении команды на запуск обработки потока данных Meta Node последовательно отправляет соответствующим Machine Node команды запуска действий, при этом делает это в порядке, который является обратным топологической сортировке графа обработки данных. Такой подход гарантирует, что при запуске источников данных все узлы уже будут готовы к обработке и выходные очереди не будут разрастаться.

Обработка команды, останавливающей обработку, производится наоборот, то есть в порядке топологической сортировки: сначала отключаются источники данных, а после этого обработчики. Таким образом, никакие созданные в источнике данные не будут потеряны.

Для обеспечения высокой доступности используется следующий подход. Каждые `M` секунд Meta Node с помощью метода `/ping` последовательно опрашивает все доступные ему Machine Node и формирует список запущенных действий. После этого этот список сравнивается со списком действий, которые должны работать в соответствии с запущенными пользователем графами. Каждый граф рассматривается отдельно в порядке, обратном порядку топологической сортировки. Если обнаруживается действие, которое запущено пользователем, но не обнаружено в списке работающих, начинается процедура его восстановления:
* командой `/run` запускается резервный узел с потерянным действием;
* всем вышестоящим узлам отправляется команда `/change_out`, при этом если вышестоящий узел не отвечает или не может выполнить команду, то ему отправляется команда `/stop` и узел также считается неработающим и подлежит процедуре восстановления.

Восстановление успешно заканчивается, когда резервный узел был успешно запущен, а все вышестоящие узлы начали отправлять ему данные.


### Конфигурация

| Параметр      | Значение по умолчанию | Описание |
| ------------- | ------------- | ----- |
| http.host     | 0.0.0.0 | хост, на котором запускается сервер, предоставляющий API |
| http.port     | 8080      | порт, на котором запускается сервер, предоставляющий API |
| logging.logfile | stdout      | Имя файла для логирования или же stdout для записи в консоль |
| logging.level | info      | Уровень логирования |
| logging.truncate-file | false      | Если true, очищает файл перед началом записи логов при включении |
| etcd.endpoints | []      | Список адресов узлов etcd в формате `host:port` |
| etcd.timeout | 1m      | Таймаут при обращении к etcd |
| etcd.retry.delay | 1s      | Задержка между попытками обращения к etcd |
| etcd.retry.count | 5      | количество попыток обращения к etcd |
| watcher.ping-freq | 5s      | время между запросами к machine_node для получения информации о состоянии машин и запущенных на них рантаймов |
| watcher.retry.delay | 1s      | задержка между попытками применения запросов на восстановление узла |
| watcher.retry.count | 5      | количество попыток сделать запрос на восстановление узла |
| watcher.machine-watcher.machines | []      | Список серверов, для которых заданы хост, сервисный порт и таймаут на выполнение операций |
